<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Guru Wali - Portal Bimbingan Siswa</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #0066cc;
            --primary-dark: #0052a3;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        html, body { height: 100%; width: 100%; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .hidden { display: none !important; }
        
        .container {
            max-width: 750px;
            width: 100%;
            background: white;
            padding: 0;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.5s ease-out;
            overflow: hidden;
        }
        
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .header-banner {
            background: linear-gradient(135deg, var(--primary) 0%, #0052a3 100%);
            padding: 30px 25px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-content {
            flex: 1;
        }
        
        .header-banner h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .header-banner p {
            font-size: 13px;
            opacity: 0.95;
        }
        
        .header-icon {
            font-size: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 20px;
            flex-shrink: 0;
        }
        
        .content {
            padding: 30px 25px;
        }
        
        /* ===== LOADING ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top: 5px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-overlay h3 {
            color: white;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            margin: 8px 0;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            display: block;
            text-align: center;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            padding: 8px 12px;
            font-size: 13px;
            width: auto;
            display: inline-block;
            margin: 4px;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }
        
        .btn-back {
            background: var(--gray-200);
            color: var(--gray-800);
            margin-bottom: 20px;
            font-weight: 500;
            padding: 10px 16px;
            width: auto;
            display: inline-block;
        }
        
        .btn-back:hover {
            background: var(--gray-300);
        }
        
        .btn-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-icon::after {
            content: '‚Üí';
            display: inline-block;
            transition: transform 0.3s;
        }
        
        .btn:hover .btn-icon::after {
            transform: translateX(4px);
        }
        
        /* ===== FORM ELEMENTS ===== */
        .form-group {
            margin-bottom: 14px;
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 5px;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            color: var(--gray-800);
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            background: rgba(0, 102, 204, 0.02);
        }
        
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        /* ===== FORM SECTIONS ===== */
        .form-section {
            background: var(--gray-50);
            padding: 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .form-section h4 {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        .form-row.three-col {
            grid-template-columns: 1fr 0.8fr 1.5fr;
            gap: 12px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }
        
        /* ===== TABLE ===== */
        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--gray-200);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 14px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            border-bottom: 1px solid var(--gray-200);
            padding: 14px;
            font-size: 14px;
            color: var(--gray-800);
        }
        
        tbody tr {
            transition: background 0.2s;
        }
        
        tbody tr:hover {
            background: var(--gray-50);
        }
        
        tbody tr:last-child td {
            border-bottom: none;
        }
        
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-600);
        }
        
        /* ===== MENU GRID ===== */
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }
        
        .menu-card {
            background: linear-gradient(135deg, #f0f7ff 0%, #f5f0ff 100%);
            padding: 28px 20px;
            border-radius: 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
            background: linear-gradient(135deg, #e6f2ff 0%, #ede9ff 100%);
        }
        
        .menu-card .icon {
            font-size: 36px;
            margin-bottom: 12px;
            display: block;
        }
        
        .menu-card h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 6px;
        }
        
        .menu-card p {
            color: var(--gray-600);
            font-size: 12px;
            margin: 0;
        }
        
        .menu-card::after {
            content: '‚Üí';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: var(--primary);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .menu-card:hover::after {
            opacity: 1;
            transform: translateY(-50%) translateX(4px);
        }
        
        /* LOGIN FORM STYLING */
        #page-login .content {
            text-align: center;
        }
        
        #page-login .form-group {
            text-align: left;
            margin-bottom: 16px;
        }
        
        /* WELCOME PAGE STYLING */
        .welcome-icon {
            font-size: 80px;
            margin-bottom: 20px;
            display: block;
        }
        
        .welcome-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 12px;
        }
        
        .welcome-subtitle {
            font-size: 15px;
            color: var(--gray-600);
            margin: 0;
        }
        
        /* ===== ERROR MESSAGE ===== */
        .error-message {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid var(--danger);
            color: #7f1d1d;
            padding: 14px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .error-message.hidden {
            display: none;
        }
        
        .error-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr !important;
            }
            
            .form-row.three-col {
                grid-template-columns: 1fr !important;
            }
            
            .form-row.full {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 16px;
                max-width: 100%;
            }
            
            .header-banner {
                padding: 20px 18px;
            }
            
            .header-banner h2 {
                font-size: 20px;
                margin-bottom: 4px;
            }
            
            .header-banner p {
                font-size: 12px;
            }
            
            .content {
                padding: 16px;
            }
            
            .form-group {
                margin-bottom: 10px;
            }
            
            .form-group label {
                font-size: 11px;
                margin-bottom: 4px;
            }
            
            input, textarea {
                padding: 9px 10px;
                font-size: 12px;
            }
            
            textarea {
                min-height: 50px;
            }
            
            .form-section {
                padding: 14px;
                margin-bottom: 16px;
                border-radius: 10px;
            }
            
            .form-section h4 {
                font-size: 12px;
                margin-bottom: 12px;
            }
            
            .form-row {
                gap: 10px;
                margin-bottom: 10px;
            }
            
            .btn {
                padding: 11px 14px;
                font-size: 13px;
                margin: 6px 0;
            }
            
            .btn-back {
                padding: 8px 12px;
                font-size: 12px;
                margin-bottom: 12px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-top: 18px;
            }
            
            .menu-card {
                padding: 20px 16px;
            }
            
            .menu-card .icon {
                font-size: 28px;
                margin-bottom: 8px;
            }
            
            .menu-card h3 {
                font-size: 14px;
                margin-bottom: 4px;
            }
            
            .menu-card p {
                font-size: 11px;
            }
            
            .welcome-icon {
                font-size: 60px;
                margin-bottom: 16px;
            }
            
            .welcome-title {
                font-size: 20px;
                margin-bottom: 8px;
            }
            
            .welcome-subtitle {
                font-size: 13px;
            }
            
            table {
                font-size: 11px;
            }
            
            th {
                padding: 9px 6px;
                font-size: 10px;
            }
            
            td {
                padding: 9px 6px;
                font-size: 11px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="loading" class="hidden loading-overlay">
   <div class="spinner"></div>
   <h3>Memproses...</h3>
  </div><!-- LOGIN PAGE -->
  <div id="page-login" class="page container">
   <div class="header-banner">
    <div class="header-content">
     <h2>Portal Guru Wali</h2>
     <p></p>
    </div>
    <div class="header-icon">
     üë®‚Äçüè´
    </div>
   </div>
   <div class="content">
    <div id="error-alert" class="error-message hidden"><span class="error-icon">!</span> <span>Username atau sandi salah! Silakan coba lagi.</span>
    </div>
    <div class="form-group"><label for="username">Username</label> <input type="text" id="username" placeholder="Masukkan username">
    </div>
    <div class="form-group"><label for="password">Sandi</label> <input type="password" id="password" placeholder="Masukkan sandi">
    </div><button class="btn btn-primary" onclick="handleLogin()">Masuk Sekarang</button>
   </div>
  </div><!-- MAIN CONTENT -->
  <div id="main-content" class="hidden"><!-- WELCOME PAGE -->
   <div id="page-welcome" class="page container">
    <div class="header-banner">
     <h2>Selamat Datang! üëã</h2>
     <p></p>
    </div>
    <div class="content" style="text-align: center; padding: 60px 25px;">
     <div style="margin-bottom: 40px;"><span class="welcome-icon">üìö</span>
      <h3 class="welcome-title">Sistem Bimbingan Siswa</h3>
      <p class="welcome-subtitle">Kelola data bimbingan siswa dengan mudah dan efisien</p>
     </div><button class="btn btn-primary" onclick="showPage('page-menu')">Mulai Sekarang</button>
    </div>
   </div><!-- MENU PAGE -->
   <div id="page-menu" class="page container">
    <div class="header-banner">
     <h2>Menu Utama</h2>
     <p></p>
    </div>
    <div class="content">
     <p style="text-align: center; font-size: 15px; color: var(--gray-600); margin-bottom: 25px;">Selamat datang! Pilih menu di bawah ini</p>
     <div class="menu-grid">
      <div class="menu-card" onclick="showPage('page-form')"><span class="icon">üìù</span>
       <h3>Input Bimbingan</h3>
       <p>Tambah data baru</p>
      </div>
      <div class="menu-card" onclick="fetchData()"><span class="icon">üìä</span>
       <h3>Lihat Data Online</h3>
       <p>Database cloud</p>
      </div>
     </div><button class="btn btn-secondary" style="margin-top: 25px;" onclick="location.reload()">Logout</button>
    </div>
   </div><!-- FORM PAGE -->
   <div id="page-form" class="hidden page container">
    <div class="header-banner">
     <h2>Form Bimbingan Siswa</h2>
     <p>Isi data bimbingan dengan lengkap</p>
    </div>
    <div class="content"><button class="btn-back" onclick="showPage('page-menu')">Kembali ke Menu</button>
     <form id="bimbinganForm"><!-- SECTION: DATA SISWA -->
      <div class="form-section">
       <h4>üìö Data Siswa</h4>
       <div class="form-row three-col">
        <div class="form-group"><label for="tanggal">Tanggal</label> <input type="date" id="tanggal" required>
        </div>
        <div class="form-group"><label for="nis">NIS</label> <input type="text" id="nis" placeholder="12345" required>
        </div>
        <div class="form-group"><label for="nama">Nama Siswa</label> <input type="text" id="nama" placeholder="Nama lengkap" required>
        </div>
       </div>
      </div><!-- SECTION: CATATAN BIMBINGAN -->
      <div class="form-section">
       <h4>üìã Catatan Bimbingan</h4>
       <div class="form-row full">
        <div class="form-group"><label for="catatan">Masalah/Bimbingan</label> <textarea id="catatan" placeholder="Tulis masalah yang dihadapi..."></textarea>
        </div>
       </div>
       <div class="form-row full">
        <div class="form-group"><label for="tindakLanjut">Tindak Lanjut</label> <textarea id="tindakLanjut" placeholder="Rencana tindak lanjut..."></textarea>
        </div>
       </div>
      </div><!-- SECTION: DATA ORANG TUA -->
      <div class="form-section">
       <h4>üë®‚Äçüë©‚Äçüëß Data Orang Tua</h4>
       <div class="form-row three-col">
        <div class="form-group"><label for="namaOrtu">Nama Orang Tua</label> <input type="text" id="namaOrtu" placeholder="Nama orang tua">
        </div>
        <div class="form-group"><label for="telp">No. Telp</label> <input type="text" id="telp" placeholder="0812345..." required>
        </div>
        <div class="form-group"><label for="pekerjaan">Pekerjaan</label> <input type="text" id="pekerjaan" placeholder="Profesi">
        </div>
       </div>
       <div class="form-row full">
        <div class="form-group"><label for="alamat">Alamat Rumah</label> <input type="text" id="alamat" placeholder="Alamat">
        </div>
       </div>
      </div><button type="submit" class="btn btn-success">Simpan Data</button>
     </form>
    </div>
   </div><!-- DATA PAGE -->
   <div id="page-data" class="hidden page container" style="max-width: 900px;">
    <div class="header-banner">
     <h2>Database Online</h2>
     <p>Lihat dan kelola semua data bimbingan</p>
    </div>
    <div class="content"><button class="btn-back" onclick="showPage('page-menu')">Kembali ke Menu</button> <button class="btn btn-primary" onclick="downloadExcel()">Download Excel</button>
     <div class="table-wrapper">
      <table>
       <thead>
        <tr>
         <th>Tanggal</th>
         <th>Nama Siswa</th>
         <th>NIS</th>
         <th>Aksi</th>
        </tr>
       </thead>
       <tbody id="data-body">
        <tr>
         <td colspan="4" class="no-data">Memuat data...</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div>
  </div>
  <script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzjTHx0i5Ae1cqnv5JE9U4D9Hnu-SS1p3gTXljy0vkgsUeYMufsLfvfGJb6elDJYClQxQ/exec";
let bimbinganData = [];

function toggleLoading(show) {
  document.getElementById('loading').classList[show ? 'remove' : 'add']('hidden');
}

function showPage(id) {
  ['page-welcome','page-menu','page-form','page-data']
    .forEach(p => document.getElementById(p).classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function fetchData() {
  toggleLoading(true);

  fetch(SCRIPT_URL + "?action=read")
    .then(res => res.json())
    .then(data => {
      bimbinganData = data;
      renderTable();
      showPage('page-data');
    })
    .catch(err => {
      alert("Gagal mengambil data");
      console.error(err);
    })
    .finally(() => toggleLoading(false));
}

function renderTable() {
  const tbody = document.getElementById('data-body');
  tbody.innerHTML = "";

  if (bimbinganData.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" class="no-data">Belum ada data</td></tr>`;
    return;
  }

  bimbinganData.forEach(item => {
    tbody.innerHTML += `
      <tr>
        <td>${item.Tanggal}</td>
        <td>${item.Nama}</td>
        <td>${item.NIS}</td>
        <td>
          <button class="btn btn-danger" onclick="deleteData('${item.NIS}')">Hapus</button>
        </td>
      </tr>
    `;
  });
}

function deleteData(nis) {
  if (!confirm("Hapus data NIS " + nis + "?")) return;

  toggleLoading(true);

  fetch(SCRIPT_URL + "?action=delete&nis=" + encodeURIComponent(nis))
    .then(res => res.text())
    .then(() => fetchData())
    .catch(() => fetchData())
    .finally(() => toggleLoading(false));
}

document.getElementById('bimbinganForm').onsubmit = function(e) {
  e.preventDefault();

  const data = {
    action: "add",
    tanggal: tanggal.value,
    nis: nis.value,
    nama: nama.value,
    catatan: catatan.value,
    tindakLanjut: tindakLanjut.value,
    alamat: alamat.value,
    namaOrtu: namaOrtu.value,
    telp: telp.value,
    pekerjaan: pekerjaan.value
  };

  toggleLoading(true);

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(() => {
    alert("Data tersimpan");
    this.reset();
    showPage('page-menu');
  })
  .finally(() => toggleLoading(false));
};

function downloadExcel() {
  if (!bimbinganData.length) return alert("Tidak ada data");

  const ws = XLSX.utils.json_to_sheet(bimbinganData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Data");
  XLSX.writeFile(wb, "Data_Bimbingan.xlsx");
}
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c9f768de492fd91',t:'MTc3MDQzMTQwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>



